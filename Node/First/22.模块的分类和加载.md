#### nodejs中模块的分类

- 内置模块(官网内置的模块)
- 自己写文件模块(如`.js`、`.json`、`.node(c/c++编写的模块)`等文件)，如果加载时，没有制定后缀名，那么就按照`.js>.json>.node`的加载顺序依次加载相应模块
- 自定义模块(第三方模块),就是我们要从`npm`上下载的模块，比如`mime`

所有内置模块在安装`node.js`的时候就已经编译成二进制文件，可以直接加载运行(速度较快)部分内置模块，在`node.exe`这个进程启动的时候就已经默认加载了，所以可以直接使用。

#### require函数加载模块过程

##### 情况一 (文件模块)

```js
//加载路径，文件模块
require('./index.js')
```

加载文件模块时，如果没有后缀，比如`require('./aa')`，寻找的过程如下：

1. 先寻找该路径下是否存在`aa.js`
2. 是否存在`aa.json`
3. 是否存在`aa.node`
4. 以上如果都没找到，那么`aa`是不是是一个文件夹，如果是将其当做第三方模块
5. 第三方模块，首先是否存在`package.json`，如果存在则看该文件中的`main`这个字段中的入口文件。
6. 如果没有`package.json`，那么是否存在`index.js`，如果没有，则是否存在`index.json`，如没有，是否存在`index.node`，还没有则加载失败

##### 情况二，（核心模块或第三方模块）

导入一个模块，一个目录一个目录的`node_modules`这样寻找下去，直到根目录。

```js
//module_path.js
import xx from 'xx'
console.log(module.paths);

//执行module_path.js文件， 会输出一个数组
//在linux下
[
    '/home/jackson/research/node_modules', 
    '/home/jackson/node_modules', 
    '/home/node_modules',
    '/node_modules'
]
//在windows下
[ 'c:\\nodejs\\node_modules', 'c:\\node_modules' ]
```

模块路径的生成规则如下所示。

- 当前文件目录下的`node_modules`目录。
- 父目录下的`node_modules`目录。
- 父目录的父目录下的`node_modules`目录。
- 沿路径向上逐级递归，直到根目录下的`node_modules`目录。

```js
//加载内置模块
require('http')
//加载第三方模块
require('mime')
//或
require('xx/xx/xx')   //开头没有以/ 或 ./这种形式开头的， 就是直接在node_mod1e下的模块中开始寻找
```
1. 先在核心模块中查找，是否有和给定名字一样的模块，如果有则直接加载该模块。
2. 如果核心模块中没有该模块，那么就会认为这个模块是一个第三方模块(自定义模块)
3. 于是会去当前文件所在的目录下去找`node_modules`这个文件夹中的该名的模块。如果没有，则再去当前目录的父目录中的`node_modules`是中寻找。还没有就再上一层的`node_modules`。直到系统根目录中的`node_modules`。
4. 然后在`node_modules`下找到相应的模块文件夹，此时就按照
   1. 首先该文件夹中是否存在`package.json`文件，该文件中的`main`字段就是入口文件
   2. 如果没有`package.json`文件或`main`字段没声明，则依次按照该目录下`index.js`、`index.json`、`index.node`的顺序寻找。


#### require加载模块时的注意点

1. 只要第一次加载过后，就会把这个模块缓存起来，等下次加载，都是首先去缓存中寻找，没有的情况下才会执行上面的加载机制。
2. 任何模块加载都是先去缓存中先寻找。
3. 核心模块在`nodejs`源码编译的时候，都已经编译为二进制执行文件，所以加载速度比较快(核心模块加载的优先级仅次于 缓存加载)
4. 核心模块都保存在lib目录下
  - 试图加载一个和核心模块同名的自定义模块(第三方模块)是不会成功的	
  - 自定模块要么名字不与核心模块同名，要么使用路径的方式加载
5. 核心模块只能通过模块名称来加载(错误实例`require('./http')`)；这样是无法加载`http`模块的
6. `require()`加载模块使用`./`相对路径时，相对路径是相对当前模块，不受执行`node`命令的路径影响
7. 建议加载文件模块的时候始终添加文件后缀名，不要省略
